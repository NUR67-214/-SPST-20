<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>แบบประเมินความเครียด (SPST-20) | Stress Check</title>
<meta name="description" content="ประเมินความเครียดของคุณตอนนี้ด้วย SPST-20 พร้อมคำแนะนำคลายเครียด และแบบประเมินความพึงพอใจ" />
<style>
:root {
  --bg: #e3f0fc; /* ฟ้าอ่อน */
  --card: #ffffff;
  --ink: #111827;
  --muted: #6b7280;
  --brand: #2563eb;
  --brand-ink: #fff;
  --ok: #16a34a;
  --warn: #f59e0b;
  --bad: #dc2626;
  --ring: 0 0 0 3px rgba(37, 99, 235, 0.25);
}
* {
  box-sizing: border-box;
}
html,
body {
  height: 100%;
}
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, TH Sarabun New, Leelawadee, K2D, sans-serif;
  background: var(--bg);
  color: var(--ink);
}
#matchGrid {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 คอลัมน์ */
  gap: 8px; /* ช่องว่างระหว่างไพ่ */
  max-width: 360px;
  margin: 10px auto;
}

#matchGrid .card {
  width: 100%;       /* เต็มคอลัมน์ */
  aspect-ratio: 1/1; /* ให้เป็นสี่เหลี่ยมจัตุรัส */
  background-color: #3498db;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 32px;
  color: #fff;
  cursor: pointer;
  border-radius: 10px;
  user-select: none;
}

#matchGrid .card.flipped {
  background-color: #2ecc71;
}
#matchGrid .card.matched {
  background-color: #e74c3c;
  cursor: default;
}
#scoreBox, .result {
    font-variant-numeric: normal; /* ป้องกันเลขไทย */
    font-feature-settings: "lnum"; /* ใช้เลขอารบิก */
    color: #111827; /* สีตัวอักษรดำ */
  }
.wrap {
  max-width: 980px;
  margin: 0 auto;
  padding: 24px;
}
header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 16px;
}
.logo-img {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  background: #fff;
  display: grid;
  place-items: center;
}
.logo-img img {
  width: 48px;
  height: 48px;
  display: block;
}
h1 {
  font-size: clamp(20px, 3vw, 28px);
  margin: 0;
}
.card {
  background: var(--card);
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
}
.stage {
  padding: 24px;
}
.muted {
  color: var(--muted);
}
.btns {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 20px;
}
button,
.btn {
  appearance: none;
  border: 0;
  padding: 12px 16px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
}
.primary {
  background: var(--brand);
  color: var(--brand-ink);
}
.ghost {
  background: #eef2ff;
  color: #1e3a8a;
}
.subtle {
  background: #f3f4f6;
}
button:focus-visible {
  outline: none;
  box-shadow: var(--ring);
}
.progress {
  height: 8px;
  background: #e5e7eb;
  border-radius: 999px;
  overflow: hidden;
  margin: 16px 24px;
}
.bar {
  height: 100%;
  width: 0;
  background: linear-gradient(90deg, #60a5fa, #2563eb);
  transition: width 0.4s ease;
}
.grid {
  display: grid;
  gap: 16px;
}
@media (min-width: 720px) {
  .grid-2 {
    grid-template-columns: 1fr 1fr;
  }
}
.pill {
  display: inline-block;
  padding: 6px 10px;
  border-radius: 999px;
  background: #eef2ff;
  color: #3730a3;
  font-size: 12px;
}
.q {
  padding: 12px 14px;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
}
.q h4 {
  margin: 0 0 8px 0;
  font-size: 16px;
}
.scale {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.scale label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 10px;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  cursor: pointer;
}
input[type="radio"] {
  accent-color: #2563eb;
}
.result {
  padding: 14px;
  border-radius: 12px;
  border: 1px dashed #d1d5db;
  background: #f9fafb;
}
.chipset {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}
.chip {
  width: 140px;
  aspect-ratio: 1/1;
  border-radius: 50%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 2px solid #e5e7eb;
  background: #fff;
  cursor: pointer;
  text-align: center;
  padding: 12px;
}
.chip:focus-visible {
  outline: none;
  box-shadow: var(--ring);
}
.chip svg {
  width: 28px;
  height: 28px;
  margin-bottom: 8px;
}
.circle-breathe {
  width: 220px;
  height: 220px;
  border-radius: 50%;
  border: 6px solid #93c5fd;
  margin: 20px auto;
  display: grid;
  place-items: center;
  transition: transform 4s ease;
}
.label-center {
  text-align: center;
  font-weight: 600;
}
.stars {
  display: flex;
  gap: 6px;
  font-size: 28px;
  cursor: pointer;
}
.stars button {
  background: transparent;
  font-size: 28px;
  line-height: 1;
}
.hide {
  display: none !important;
}
.note {
  color: var(--bad);
  background: #fff0f0;
  padding: 10px 16px;
  border-radius: 8px;
  margin-bottom: 12px;
}
footer {
  margin-top: 24px;
  font-size: 12px;
}
.tag-ok {
  color: var(--ok);
}
.tag-warn {
  color: var(--warn);
}
.tag-bad {
  color: var(--bad);
}
</style>
</head>
<body>
<div class="wrap">
<header aria-label="หัวเว็บ">
<div class="logo-img">
<!-- ใส่รูปโลโก้ (image 2) -->
<img src="stress-logo.png" alt="โลโก้สุขภาพจิต" />
</div>
<div>
<h1>แบบประเมินความเครียด (SPST-20) • Stress Check</h1>
<div class="muted">รู้ระดับความเครียดของคุณตอนนี้ พร้อมคำแนะนำคลายเครียดอย่างปลอดภัย</div>
</div>
</header>
<div class="card">
<div class="progress"><div id="bar" class="bar"></div></div>
<!-- Stage 1: Intro -->
<section class="stage" data-step="1">
<p class="pill">หน้าแรก</p>
<h2>ประเมินความเครียดของคุณตอนนี้เลย</h2>
<p class="muted">เครื่องมือ: แบบวัดความเครียด กรมสุขภาพจิต (SPST-20)</p>
<div class="btns">
<button class="primary" id="startBtn">เริ่มทำแบบประเมิน</button>
</div>
</section>
<!-- Stage 2: Instruction -->
<section class="stage hide" data-step="2">
<p class="pill">คำชี้แจง</p>
<h3>แบบวัดความเครียด กรมสุขภาพจิต (SPST-20)</h3>
<div class="note">
<strong>หมายเหตุ:</strong> <br>
<span>ต้องตอบครบทั้ง <strong>20 ข้อ</strong>จึงจะสามารถคำนวณผลได้ หากตอบไม่ครบจะไม่มีการประเมินคะแนน</span>
</div>
<p>ในระยะ <strong>6 เดือนที่ผ่านมา</strong> หากเหตุการณ์ในข้อใดเกิดขึ้นกับคุณ และคุณรู้สึกอย่างไรต่อเหตุการณ์นั้น ให้เลือกระดับความเครียด 1–5 ของข้อนั้น <em>(ห้ามข้าม ต้องตอบทุกข้อ)</em></p>
<ul>
<li>1 = ไม่รู้สึกเครียด</li>
<li>2 = เครียดเล็กน้อย</li>
<li>3 = เครียดปานกลาง</li>
<li>4 = เครียดมาก</li>
<li>5 = เครียดมากที่สุด</li>
</ul>
<div class="btns">
<button class="subtle" data-nav="back">ย้อนกลับ</button>
<button class="primary" data-nav="next">เริ่มทำข้อคำถาม</button>
</div>
</section>
<!-- Stage 3: Questionnaire -->
<section class="stage hide" data-step="3" aria-live="polite">
<p class="pill">แบบประเมิน 20 ข้อ</p>
<div class="note">
<strong>หมายเหตุ:</strong> ต้องตอบครบทุกข้อก่อนถึงจะคำนวณและแปลผลได้
</div>
<div id="questions" class="grid"></div>
<div class="btns">
<button class="subtle" data-nav="back">ย้อนกลับ</button>
<button class="primary" id="calcBtn">คำนวณคะแนน & แปลผล</button>
</div>
<div id="scoreBox" class="result hide" role="status" aria-live="polite"></div>
</section>
<!-- Stage 4: Manage stress options -->
<section class="stage hide" data-step="4">
<p class="pill">แนวทางคลายเครียด</p>
<h3>เลือกวิธีที่อยากลองตอนนี้</h3>
<div class="chipset" role="listbox" aria-label="เลือกกิจกรรม">
<button class="chip" data-choice="music" aria-label="ฟังเพลง">
<svg viewBox="0 0 24 24" fill="none"><path d="M9 18V5l11-2v13" stroke="currentColor" stroke-width="2"/><circle cx="7" cy="18" r="3" stroke="currentColor" stroke-width="2"/><circle cx="18" cy="16" r="3" stroke="currentColor" stroke-width="2"/></svg>
<div>ฟังเพลง</div>
</button>
<button class="chip" data-choice="breath" aria-label="ทำสมาธิ ฝึกหายใจ">
<svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="2"/></svg>
<div>ทำสมาธิ-ฝึกหายใจ</div>
</button>
<button class="chip" data-choice="game" aria-label="เล่นเกมสั้นๆ">
<svg viewBox="0 0 24 24" fill="none"><rect x="3" y="7" width="18" height="10" rx="3" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="12" r="1" fill="currentColor"/><circle cx="15" cy="12" r="1" fill="currentColor"/></svg>
<div>เล่นเกม</div>
</button>
<button class="chip" data-choice="video" aria-label="วิดีโอผ่อนคลาย">
<svg viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M10 9l6 3-6 3V9z" fill="currentColor"/></svg>
<div>วิดีโอผ่อนคลาย</div>
</button>
<button class="chip" data-choice="crisis" aria-label="เครียดรุนแรง ติดต่อด่วน">
<svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><path d="M12 7v6" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="17" r="1.5" fill="currentColor"/></svg>
<div>เครียดรุนแรง</div>
</button>
</div>
<div class="btns">
<button class="subtle" data-nav="back">ย้อนกลับ</button>
<button class="primary" id="goChoice" disabled>ถัดไป</button>
</div>
<div id="crisisInfo" class="result hide">
<strong>ต้องการความช่วยเหลือด่วน?</strong>
<ul>
<li>สายด่วนสุขภาพจิต <strong>1323</strong> (ฟรี 24 ชม.) – กรมสุขภาพจิต</li>
<li>สายด่วน <strong>1669</strong> (การแพทย์ฉุกเฉิน)</li>
<li>ช่องทางออนไลน์ <strong>LINE</strong> และ <strong>Facebook Fanpage 1323</strong> <a href="https://www.facebook.com/helpline1323/?locale=th_TH" target="_blank">ดูรายละเอียด</a></li>
</ul>
<div class="muted" style="margin-top:8px;">
<strong>หมายเหตุ:</strong> หากมีความเสี่ยง หรือมีอันตรายต่อชีวิต กรุณาติดต่อสายด่วนทันที
</div>
</div>
</section>
<!-- Stage 5: Show chosen method -->
<section class="stage hide" data-step="5">
  <p class="pill">เริ่มคลายเครียด</p>
  
  <!-- โซนแสดงกิจกรรม -->
  <div id="methodPane"></div>
  
  <!-- โซนเกมจับคู่ภาพ -->
  <h3>เกมจับคู่ภาพ (Memory Game)</h3>
  <div class="grid" id="matchGrid"></div>

  <div class="btns">
    <button class="subtle" data-nav="back">ย้อนกลับ</button>
    <button class="primary" data-nav="next">ถัดไป</button>
  </div>
</section>

<!-- Stage 6: Satisfaction survey (10 items) -->
<section class="stage hide" data-step="6">
<p class="pill">แบบประเมินความพึงพอใจ</p>
<p>โปรดประเมินความพึงพอใจต่อประสบการณ์ใช้งาน (1 = น้อยมาก … 5 = มากที่สุด)</p>
<div id="satQs" class="grid"></div>
<div class="btns">
<button class="subtle" data-nav="back">ย้อนกลับ</button>
<button class="primary" data-nav="next">ถัดไป</button>
</div>
</section>
<!-- Stage 7: Suggestions + star rating -->
<section class="stage hide" data-step="7">
<p class="pill">ข้อเสนอแนะ</p>
<label for="feedback">มีอะไรอยากให้ปรับปรุง/เพิ่มเติมบ้าง?</label>
<textarea id="feedback" rows="5" style="width:100%;margin-top:8px;border-radius:10px;border:1px solid #e5e7eb;padding:10px"></textarea>
<div style="margin-top:14px">
ให้คะแนนโดยรวม:
<div class="stars" role="radiogroup" aria-label="ให้ดาว">
<button data-star="1" aria-label="1 ดาว">☆</button>
<button data-star="2" aria-label="2 ดาว">☆</button>
<button data-star="3" aria-label="3 ดาว">☆</button>
<button data-star="4" aria-label="4 ดาว">☆</button>
<button data-star="5" aria-label="5 ดาว">☆</button>
</div>
</div>
<div class="btns">
<button class="subtle" data-nav="back">ย้อนกลับ</button>
<button class="primary" data-nav="next">ถัดไป</button>
</div>
</section>
<!-- Stage 8: Thank you -->
<section class="stage hide" data-step="8">
<p class="pill">เสร็จสิ้น</p>
<h2>ขอบคุณสำหรับการทำแบบประเมิน 💙</h2>
<p class="muted">คุณสามารถบันทึกผลไว้ใช้อ้างอิงส่วนตัว หรือเริ่มทำใหม่ได้ทุกเมื่อ</p>
<div id="summaryOut" class="result"></div>
<div class="btns">
<button class="ghost" id="restart">เริ่มใหม่อีกครั้ง</button>
</div>
</section>
</div>
<footer class="muted">
อ้างอิง: เกณฑ์แปลผลและข้อคำถาม SPST-20 จากเอกสารของกรมสุขภาพจิต/โรงพยาบาลสวนปรุง; ช่องทางช่วยเหลือ 1323 และหน่วยงานที่เกี่ยวข้อง; หลักฐานเชิงวิจัยเรื่องการฝึกหายใจเพื่อลดความเครียด (มีผลต่อระบบประสาทพาราซิมพาเทติก) และแนวทางพัฒนาแบบลิเคิร์ต 5 ระดับ (Likert). แหล่งที่มาแนบท้ายหน้านี้
</footer>
</div>
<script>
  // ---------- เกมจับคู่ภาพ ----------
const icons = ['🍎','🍌','🍇','🍒','🥝','🍍','🍉','🍑'];
let cards = [...icons, ...icons]; // ทำไพ่คู่
cards.sort(() => 0.5 - Math.random()); // สลับไพ่

const matchGrid = document.getElementById('matchGrid');
let flippedCards = [];
let matchedCards = 0;

// สร้างไพ่ลงกริด
cards.forEach(icon => {
  const card = document.createElement('div');
  card.classList.add('card');
  card.dataset.icon = icon;
  card.addEventListener('click', flipCard);
  matchGrid.appendChild(card);
});

function flipCard() {
  if (flippedCards.length < 2 && !this.classList.contains('flipped') && !this.classList.contains('matched')) {
    this.classList.add('flipped');
    this.textContent = this.dataset.icon;
    flippedCards.push(this);

    if (flippedCards.length === 2) {
      setTimeout(checkMatch, 500);
    }
  }
}

function checkMatch() {
  const [card1, card2] = flippedCards;
  if (card1.dataset.icon === card2.dataset.icon) {
    card1.classList.add('matched');
    card2.classList.add('matched');
    matchedCards += 2;
    if (matchedCards === cards.length) {
      setTimeout(() => alert('คุณชนะ! 🎉'), 300);
    }
  } else {
    card1.classList.remove('flipped');
    card2.classList.remove('flipped');
    card1.textContent = '';
    card2.textContent = '';
  }
  flippedCards = [];
}

// ---------- App state ----------
const state = {
  step: 1,
  answers: {},
  score: 0,
  interp: "",
  choice: null,
  sat: {},
  stars: 0,
  feedback: ""
};
const stepsTotal = 8;
const bar = document.getElementById('bar');

function setStep(n){
  state.step = n;
  document.querySelectorAll('.stage').forEach(el => {
    el.classList.toggle('hide', +el.dataset.step !== n);
  });
  bar.style.width = ((n-1)/(stepsTotal-1))*100 + '%';
  window.scrollTo({top:0, behavior:'smooth'});
}

// เริ่มต้น
document.getElementById('startBtn').addEventListener('click', ()=>setStep(2));
document.querySelectorAll('[data-nav]').forEach(btn => {
  btn.addEventListener('click', e => {
    const dir = e.currentTarget.dataset.nav;
    if (dir === 'back') setStep(Math.max(1, state.step - 1));
    if (dir === 'next') setStep(Math.min(stepsTotal, state.step + 1));
  });
});

// ---------- Step 3: build SPST-20 ----------
const items = [
  "กลัวทำงานผิดพลาด","ไปไม่ถึงเป้าหมายที่วางไว้","ครอบครัวมีความขัดแย้งกันในเรื่องเงินหรือเรื่องงานในบ้าน",
  "เป็นกังวลกับเรื่องสารพิษหรือมลภาวะในอากาศ น้ำ เสียง และดิน","รู้สึกว่าต้องแข่งขันหรือเปรียบเทียบ",
  "เงินไม่พอใช้จ่าย","กล้ามเนื้อตึงหรือปวด","ปวดหัวจากความตึงเครียด",
  "ปวดหลัง","ความอยากอาหารเปลี่ยนแปลง","ปวดศีรษะข้างเดียว",
  "รู้สึกวิตกกังวล","รู้สึกคับข้องใจ","รู้สึกโกรธ หรือหงุดหงิด",
  "รู้สึกเศร้า", "ความจำไม่ดี","รู้สึกสับสน",
  "ตั้งสมาธิลำบาก","รู้สึกเหนื่อยง่าย","เป็นหวัดบ่อย ๆ"
];

const questionsDiv = document.getElementById('questions');

// สร้างคำถาม
items.forEach((t,i) => {
  const idx = i + 1;
  const q = document.createElement('div');
  q.className = 'q';
  q.innerHTML = `<h4>${idx}. ${t}</h4>
  <div class="scale" role="radiogroup" aria-label="ระดับความเครียด ข้อที่ ${idx}">
  ${[1,2,3,4,5].map(v => `
    <label>
      <input type="radio" name="q${idx}" value="${v}" />
      <span>${v}</span>
    </label>`).join('')}
  </div>`;
  questionsDiv.appendChild(q);
  q.addEventListener('change', e => {
    if (e.target.name === `q${idx}`) {
      state.answers[idx] = +e.target.value;
    }
  });
});

// คำนวณและแปลผล
const scoreBox = document.getElementById('scoreBox');
document.getElementById('calcBtn').addEventListener('click', () => {
  if (Object.keys(state.answers).length < 20) {
    scoreBox.classList.remove('hide');
    scoreBox.innerHTML = `<div class="tag-bad"><strong>กรุณาตอบให้ครบทั้ง 20 ข้อก่อน</strong><br>ระบบจะไม่ประเมินผลจนกว่าจะตอบครบทุกข้อ</div>`;
    return;
  }
  let sum = 0;
  Object.values(state.answers).forEach(v => sum += v);
  state.score = sum;
  let interp = "";
  let tag = "";
  if (sum <= 23) {
    interp = "ระดับน้อย (เป็นประโยชน์ต่อแรงจูงใจและปรับตัวได้)";
    tag = "ok";
  } else if (sum <= 41) {
    interp = "ระดับปานกลาง (อยู่ในเกณฑ์ปกติ ผ่อนคลายด้วยกิจกรรมบวก)";
    tag = "warn";
  } else if (sum <= 61) {
    interp = "ระดับสูง (กระทบชีวิตประจำวัน ควรคลายเครียดและหาทางแก้ไข/ขอปรึกษา)";
    tag = "bad";
  } else {
    interp = "ระดับรุนแรง (ส่งผลทั้งกายและใจ ควรได้รับการช่วยเหลือจากผู้เชี่ยวชาญอย่างรวดเร็ว)";
    tag = "bad";
  }
  state.interp = interp;
  scoreBox.classList.remove('hide');
scoreBox.innerHTML = `
  <div><strong>คะแนนรวม:</strong> ${sum} คะแนน</div>
  <div>การแปลผล: <strong class="tag-${tag}">${interp}</strong></div>
  <div style="margin-top:8px; white-space: pre-line; color: #111827;">
  ${sum <= 23 ? `ระดับคะแนน ๐ – 23 คะแนน
ท่านมีความเครียดอยู่ในระดับน้อยและหายไปได้ในระยะเวลาสั้น ๆ เป็นความเครียดที่เกิดขึ้นได้ในชีวิตประจำวัน และสามารถปรับตัวกับสถานการณ์ต่าง ๆ ได้อย่างเหมาะสม ความเครียดในระดับนี้ถือว่ามีประโยชน์ในการดำเนินชีวิตประจำวัน เป็นแรงจูงใจในที่นำไปสู่ความสำเร็จในชีวิตได้` : 
 sum <= 41 ? `ระดับคะแนน 24 – 41 คะแนน
ท่านมีความเครียดในระดับปานกลางเกิดขึ้นได้ในชีวิตประจำวันเนื่องจากมีสิ่งคุกคามหรือเหตุการณ์ที่ทำให้เครียด อาจรู้สึกวิตกกังวลหรือกลัว ถือว่าอยู่ในเกณฑ์ปกติ ความเครียดระดับนี้ไม่ก่อให้เกิดอันตรายหรือเป็นผลเสียต่อการดำเนินชีวิต ท่านสามารถผ่อนคลายความเครียดด้วยการทำกิจกรรมที่เพิ่มพลัง เช่น ออกกำลังกาย เล่นกีฬา ทำสิ่งที่สนุกสนานเพลิดเพลิน เช่น ฟังเพลง อ่านหนังสือ ทำงานอดิเรก หรือพูดคุยระบายความไม่สบายใจกับผู้ที่ไว้วางใจ` :
 sum <= 61 ? `ระดับคะแนน 42 – 61 คะแนน
ท่านมีความเครียดในระดับสูง เป็นระดับที่ท่านได้รับความเดือดร้อนจากสิ่งต่าง ๆ หรือเหตุการณ์รอบตัว ทำให้วิตกกังวล กลัว รู้สึกขัดแย้งหรืออยู่ในสถานการณ์ที่แก้ไขจัดการปัญหานั้นไม่ได้ ปรับความรู้สึกด้วยความลำบาก จะส่งผลต่อการใช้ชีวิตประจำวัน และการเจ็บป่วย เช่น ความดันโลหิตสูง เป็นแผลในกระเพาะอาหาร ฯลฯ สิ่งที่ท่านต้องรีบทำเมื่อมีความเครียดในระดับนี้คือ คลายเครียดด้วยวิธีที่ทำได้ง่ายแต่ได้ผลดีคือ การฝึกหายใจ คลายเครียด พูดคุยระบายความเครียดกับผู้ไว้วางใจ หาสาเหตุหรือปัญหาที่ทำให้เครียดและหาวิธีแก้ไข หากท่านไม่สามารถจัดการคลายเครียดด้วยตนเองได้ ควรปรึกษากับผู้ให้การปรึกษาในหน่วยงานต่าง ๆ` :
 `ระดับคะแนน 62 คะแนนขึ้นไป
ท่านมีความเครียดในระดับรุนแรง เป็นความเครียดระดับสูงที่เกิดต่อเนื่องหรือท่านกำลังเผชิญกับวิกฤตของชีวิต เช่น เจ็บป่วยรุนแรง เรื้อรังมีความพิการ สูญเสียคนรัก ทรัพย์สินหรือสิ่งที่รัก ความเครียดระดับนี้ส่งผลทำให้เจ็บป่วยทางกายและสุขภาพจิต ชีวิตไม่มีความสุข ความคิดฟุ้งซ่าน การตัดสินใจไม่ดี ยับยั้งอารมณ์ไม่ได้ ความเครียดระดับนี้ถ้าปล่อยไว้จะเกิดผลเสียทั้งต่อตนเองและคนใกล้ชิด ควรได้รับการช่วยเหลือจากผู้ให้การปรึกษาอย่างรวดเร็ว เช่น ทางโทรศัพท์ หรือผู้ให้การปรึกษาในหน่วยงานต่าง ๆ`
  }
  </div>
  <div class="btns" style="margin-top:10px">
    <button class="primary" onclick="setStep(4)">ถัดไป</button>
  </div>
`;

});

// ---------- Step 4: เลือกวิธีคลายเครียด ----------
let selected = null;
document.querySelectorAll('.chip').forEach(ch => {
  ch.addEventListener('click', () => {
    selected = ch.dataset.choice;
    state.choice = selected;
    document.getElementById('goChoice').disabled = false;
    document.getElementById('crisisInfo').classList.toggle('hide', selected !== 'crisis');
  });
});
document.getElementById('goChoice').addEventListener('click', () => setStep(5));

// ---------- Step 5: แสดงวิธีที่เลือก ----------
const methodPane = document.getElementById('methodPane');

function renderMethod() {
  const c = state.choice;
  // เคลียร์เนื้อหาเดิมก่อน
  methodPane.innerHTML = '';

  if (!c) {
    methodPane.innerHTML = "<p class='muted'>ยังไม่ได้เลือกวิธี</p>";
    return;
  }

  if (c !== 'crisis') {
    methodPane.innerHTML += `<div class="result" style="color:var(--ok);background:#f0fff0;border:1px solid #bef5c2;margin-bottom:12px;">
      คุณสามารถกดย้อนกลับเพื่อเลือกทำกิจกรรมอื่น ๆ ได้อีก
    </div>`;
  }

  if (c === 'music') {
  methodPane.innerHTML += `
    <h3>ฟังเพลงผ่อนคลาย</h3>
    <p class="muted">วิดีโอจาก YouTube</p>
    ${[
      "https://www.youtube.com/embed/dhFt7eURm78?autoplay=0&rel=0",
      "https://www.youtube.com/embed/HAzZH6wccew?autoplay=0&rel=0",
      "https://www.youtube.com/embed/hlWiI4xVXKY?autoplay=0&rel=0"
    ].map(src => `
      <div style="position:relative;padding-top:56.25%;border-radius:12px;overflow:hidden;border:1px solid #e5e7eb;margin-bottom:12px">
        <iframe 
          src="${src}" 
          title="YouTube video player" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen
          style="position:absolute;inset:0;width:100%;height:100%">
        </iframe>
      </div>
    `).join('')}
    <div class="result" style="margin-top:12px">
      เคล็ดลับ: เลือกเพลงจังหวะช้า-กลาง ไม่มีเนื้อร้องเยอะ เพื่อช่วยให้หัวใจและลมหายใจช้าลง
    </div>`;
}

  if (c === 'breath') {
    methodPane.innerHTML += `
      <h3>ฝึกหายใจแบบ 4-4-6 (แนะนำสำหรับลดความตึงเครียด)</h3>
      <div class="circle-breathe" id="breathCircle">
        <div class="label-center" id="breathLabel">พร้อม…</div>
      </div>
      <div class="label-center">รอบละ ~14 วินาที • ลองอย่างน้อย 6–10 รอบ</div>
      <div class="result" style="margin-top:12px">
        หลักฐานวิจัยชี้ว่าการฝึกหายใจช่วยเพิ่มการทำงานของระบบพาราซิมพาเทติก ลดความเครียดและความกังวลได้.
      </div>
      <div class="btns" style="justify-content:center">
        <button class="ghost" id="breathStart">เริ่มฝึก</button>
        <button class="subtle" id="breathStop">หยุด</button>
      </div>`;
    setupBreathing();
  }

  if (c === 'game') {
    methodPane.innerHTML += `
      <h3>เกมจิ๋วโฟกัสสายตา</h3>
      <p class="muted">คลิกที่วงกลมเท่าที่หาได้ใน 20 วินาที</p>
      <div id="gameArea" style="position:relative;height:260px;border:1px solid #e5e7eb;border-radius:12px;margin-top:8px;background:#fff"></div>
      <div class="btns"><button class="ghost" id="gameStart">เริ่มเกม</button><span id="gameInfo" class="muted"></span></div>`;
    setupGame();
  }

  if (c === 'video') {
    // ตัวอย่างวิดีโอ
    methodPane.innerHTML += `
      <h3>วิดีโอผ่อนคลาย</h3>
      <p class="muted">ฝังวิดีโอที่คุณเลือก (เช่น YouTube ลิขสิทธิ์ถูกต้อง) โดยแทนที่ src ของ iframe ด้านล่าง</p>
      <div style="position:relative;padding-top:56.25%;border-radius:12px;overflow:hidden;border:1px solid #e5e7eb">
        <iframe title="relax-video" src="" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;border:0"></iframe>
      </div>`;
  }

  if (c === 'crisis') {
    methodPane.innerHTML = `<h3>คำแนะนำสำหรับภาวะเครียดรุนแรง</h3>
      <div class="result" style="margin-bottom:0;">
        หากคุณหรือคนใกล้ตัวมีภาวะเครียดรุนแรง หรือมีความเสี่ยง กรุณาติดต่อขอความช่วยเหลือจากสายด่วนสุขภาพจิต <strong>1323</strong> หรือ สายด่วน <strong>1669</strong> (การแพทย์ฉุกเฉิน) และช่องทางออนไลน์ <strong>LINE</strong> หรือ <strong>Facebook Fanpage 1323</strong>
      </div>`;
  }
}

// ตัว setupBreathing() คงเดิม
function setupBreathing() {
  const circle = document.getElementById('breathCircle');
  const label = document.getElementById('breathLabel');
  let timer = null, phase = 0;
  const seq = [
    { text: "หายใจเข้า… 4 วินาที", scale: 1.15, dur: 4000 },
    { text: "กลั้นไว้… 4 วินาที", scale: 1.15, dur: 4000 },
    { text: "ผ่อนลมหายใจออก… 6 วินาที", scale: 1.0, dur: 6000 }
  ];
  const tick = () => {
    const p = seq[phase % seq.length];
    circle.style.transform = `scale(${p.scale})`;
    label.textContent = p.text;
    timer = setTimeout(() => {
      phase++;
      tick();
    }, p.dur);
  };
  document.getElementById('breathStart').onclick = () => {
    if (timer) clearTimeout(timer);
    phase = 0;
    tick();
  };
  document.getElementById('breathStop').onclick = () => {
    if (timer) clearTimeout(timer);
    label.textContent = "พักหายใจตามสบาย";
    circle.style.transform = 'scale(1)';
  };
}

// ตัว setupGame() พร้อมการเคลียร์
function setupGame() {
  const area = document.getElementById('gameArea');
  const info = document.getElementById('gameInfo');
  // เคลียร์ element เก่าเพื่อป้องกัน stacking
  area.innerHTML = '';

  let score = 0, time = 20, running = false, tInt = null, sInt = null;

  function spawn() {
    if (!running) return;
    const dot = document.createElement('div');
    const s = 24;
    const x = Math.random() * (area.clientWidth - s);
    const y = Math.random() * (area.clientHeight - s);
    dot.style.cssText = `position:absolute;left:${x}px;top:${y}px;width:${s}px;height:${s}px;border-radius:999px;background:#2563eb;`;
    dot.addEventListener('click', () => {
      score++;
      dot.remove();
    });
    area.appendChild(dot);
    setTimeout(() => dot.remove(), 1400);
  }

  function stop() {
    running = false;
    clearInterval(tInt);
    clearInterval(sInt);
    info.textContent = `จบเกม • ได้ ${score} วง`;
  }

  document.getElementById('gameStart').onclick = () => {
    score = 0;
    time = 20;
    area.innerHTML = ''; // เคลียร์เดิม
    running = true;
    info.textContent = `เวลา ${time}s | คะแนน 0`;
    tInt = setInterval(() => {
      time--;
      info.textContent = `เวลา ${time}s | คะแนน ${score}`;
      if (time <= 0) stop();
    }, 1000);
    sInt = setInterval(spawn, 450);
  };
}

// สังเกตเมื่อเข้าสู่ step 5 เพื่อเรียก renderMethod()
const observer = new MutationObserver(() => {
  if (!document.querySelector('[data-step="5"]').classList.contains('hide')) {
    renderMethod();
  }
});
observer.observe(document.body, { subtree: true, attributes: true, attributeFilter: ['class'] });

// ---------- Step 6: satisfaction ----------
const satItems = [
  "เข้าใจขั้นตอนการทำแบบประเมินได้ง่าย",
  "การอธิบายเกณฑ์คะแนนชัดเจน",
  "ความสะดวกในการเลือกคำตอบบนมือถือ",
  "คำแนะนำคลายเครียดมีประโยชน์",
  "ส่วนฝึกหายใจใช้งานง่ายและช่วยได้",
  "เนื้อหามีความน่าเชื่อถือ",
  "รูปแบบ/สีสบายตา",
  "ระยะเวลาที่ใช้เหมาะสม",
  "โดยรวมช่วยให้ตระหนักรู้ภาวะความเครียดของตน",
  "จะแนะนำเครื่องมือนี้ให้ผู้อื่น"
];



const satDiv = document.getElementById('satQs');

satItems.forEach((t, i) => {
  const idx = i + 1;
  const q = document.createElement('div');
  q.className = 'q';
  q.innerHTML = `<h4>${idx}. ${t}</h4>
  <div class="scale" role="radiogroup" aria-label="ความพึงพอใจ ข้อที่ ${idx}">
  ${["น้อยมาก", "น้อย", "ปานกลาง", "มาก", "มากที่สุด"].map((lab, j) => `
    <label>
      <input type="radio" name="s${idx}" value="${j + 1}" />
      <span>${j + 1}. ${lab}</span>
    </label>`).join('')}
  </div>`;
  satDiv.appendChild(q);
  q.addEventListener('change', e => {
    if (e.target.name === `s${idx}`) {
      state.sat[idx] = +e.target.value;
    }
  });
});

// ---------- Star rating & feedback ----------
document.querySelectorAll('.stars button').forEach(btn => {
  btn.addEventListener('click', () => {
    state.stars = +btn.dataset.star;
    document.querySelectorAll('.stars button').forEach((b, i) => {
      b.textContent = (i < state.stars) ? '★' : '☆';
    });
  });
});
document.getElementById('feedback').addEventListener('input', e => {
  state.feedback = e.target.value;
});

// ---------- สรุปผลและรีเซ็ต ----------
const summaryOut = document.getElementById('summaryOut');

const endObserver = new MutationObserver(() => {
  const endStage = document.querySelector('[data-step="8"]');
  if (!endStage.classList.contains('hide')) {
    const answered = Object.keys(state.answers).length;
    const satValues = Object.values(state.sat);
    const satAvg = satValues.length ? (satValues.reduce((a, b) => a + b, 0) / satValues.length).toFixed(1) : "-";
    summaryOut.innerHTML = `<div><strong>สรุปผลของคุณ</strong></div>
    <div>คะแนน SPST-20: <strong>${state.score}</strong> | <span>${state.interp}</span></div>
    <div>ตอบข้อคำถามจริง: ${answered} / 20 ข้อ</div>
    <div>ให้ดาว: ${"★".repeat(state.stars)}${"☆".repeat(5 - state.stars)}</div>
    <div>ความพึงพอใจเฉลี่ย: ${satAvg} / 5</div>
    ${state.feedback ? `<div style="margin-top:8px"><em>ข้อเสนอแนะ:</em> ${state.feedback}</div>` : ""}`;
  }
});
endObserver.observe(document.body, { subtree: true, attributes: true, attributeFilter: ['class'] });

// รีโหลดหน้าใหม่เมื่อคลิกปุ่ม
document.getElementById('restart').addEventListener('click', () => location.reload());

</script>
</body>
</html>






